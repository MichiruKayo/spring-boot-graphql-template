FROM gradle:4.1-jdk8-alpine

# Gradle image creates a 'gradle' user, so fallback to 'root' to do initial setup
USER root

RUN mkdir -p /opt/app \
    && mkdir -p /opt/.gradle

WORKDIR /opt/app

COPY .env .
COPY settings.gradle .

# Release gradle caches if any
RUN find /opt/.gradle -type f -name "*.lock" | while read f; do rm $f; done

ENTRYPOINT ["gradle", "-g", "/opt/.gradle"]
